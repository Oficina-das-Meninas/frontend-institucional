<div class="flex min-h-screen bg-[#FFF9F6]">
  <div
    class="hidden lg:flex lg:w-1/2 relative items-center justify-center p-12 bg-[#FFF9F6] overflow-hidden"
  >
    <img
      alt="Meninas abraçando"
      class="relative z-10 h-full w-full object-cover rounded-2xl shadow-xl"
      src="./meninas-abraco.webp"
    />
  </div>

  <div class="w-full lg:w-1/2 flex flex-col bg-white">
    <div
      class="flex-grow flex items-center justify-center p-6 sm:p-12 relative"
    >
      <a
        routerLink="/login"
        class="absolute top-6 right-6 flex items-center text-gray-500 hover:text-gray-900 transition-colors cursor-pointer"
      >
        <mat-icon class="mr-1 text-sm leading-none">arrow_back</mat-icon>
        <span class="text-sm font-medium">Voltar</span>
      </a>

      <div class="w-full max-w-md">
        <div class="text-center mb-8 flex flex-col items-center">
          <div class="mb-6 p-2 rounded-full shadow-sm bg-white inline-block">
            <app-logo cssClass="size-50" />
          </div>
          <h1 class="text-3xl font-bold text-gray-900">Alterar senha</h1>
          <p class="text-gray-500 mt-2">Crie uma nova senha</p>
        </div>

        <div class="bg-white sm:p-8 rounded-2xl sm:border border-gray-100">
          @if (validatingToken()) {
          <div class="flex flex-col items-center justify-center">
            <mat-icon
              class="animate-spin mb-4 text-[#C81E71]"
              style="font-size: 48px"
            >
              hourglass_empty
            </mat-icon>
            <p class="text-gray-500">Validando link...</p>
          </div>
          } @else if (!tokenValid()) {
          <div class="flex flex-col items-center justify-center text-center">
            <mat-icon
              class="text-red-500 mb-4"
              style="font-size: 48px"
            >
              error
            </mat-icon>
            <h2 class="text-xl font-bold text-gray-900 mb-2">
              Link inválido ou expirado
            </h2>
            <p class="text-gray-500 mb-6">
              O link para resetar sua senha expirou. Solicite um novo link.
            </p>
            <a
              routerLink="/esqueci-senha"
              class="w-full rounded-full bg-[#C81E71] py-3 px-4 text-base font-bold text-white shadow-sm transition-all hover:bg-[#A9125B] hover:shadow-md focus:outline-none focus:ring-2 focus:ring-[#C81E71] focus:ring-offset-2 cursor-pointer text-center"
            >
              Solicitar novo link
            </a>
          </div>
          } @else {
          <form
            [formGroup]="form"
            (ngSubmit)="onSubmit()"
            class="flex flex-col gap-4"
          >
            <div>
              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Nova senha</mat-label>
                <input
                  matInput
                  formControlName="password"
                  [type]="showPassword() ? 'text' : 'password'"
                />
                <button
                  type="button"
                  mat-icon-button
                  matSuffix
                  (click)="togglePasswordVisibility()"
                  class="!text-gray-400"
                >
                  <mat-icon>{{
                    showPassword() ? "visibility" : "visibility_off"
                  }}</mat-icon>
                </button>
                @if(formHelper.getErrorMessage(form, 'password')) {
                <mat-error
                  >{{ formHelper.getErrorMessage(form, 'password') }}</mat-error
                >
                }
              </mat-form-field>
            </div>

            <div>
              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Confirmar senha</mat-label>
                <input
                  matInput
                  formControlName="confirmPassword"
                  [type]="showConfirmPassword() ? 'text' : 'password'"
                />
                <button
                  type="button"
                  mat-icon-button
                  matSuffix
                  (click)="toggleConfirmPasswordVisibility()"
                  class="!text-gray-400"
                >
                  <mat-icon>{{
                    showConfirmPassword() ? "visibility" : "visibility_off"
                  }}</mat-icon>
                </button>
                @if(formHelper.getErrorMessage(form, 'confirmPassword')) {
                <mat-error
                  >{{ formHelper.getErrorMessage(form, 'confirmPassword') }}</mat-error
                >
                } @else if (form.hasError('passwordMismatch') &&
                form.get('confirmPassword')?.touched) {
                <mat-error>As senhas não correspondem</mat-error>
                }
              </mat-form-field>
            </div>

            <button
              class="w-full mt-2 rounded-full bg-[#C81E71] py-3 px-4 text-base font-bold text-white shadow-sm transition-all hover:bg-[#A9125B] hover:shadow-md focus:outline-none focus:ring-2 focus:ring-[#C81E71] focus:ring-offset-2 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
              type="submit"
              [disabled]="loadingRequest() || form.invalid"
            >
              @if(loadingRequest()) {
              <span>Salvando...</span>
              } @else {
              <span>Salvar senha</span>
              }
            </button>
          </form>
          }
        </div>
      </div>
    </div>
  </div>
</div>
